{% extends "ui/base.html" %}
{% block title %}{{ schedule.name }} | Checklist Schedule | {{ org.name }}{% endblock %}
{% block content %}
  <section class="panel reveal">
    {% include "ui/_crumbs_simple.html" with crumbs=crumbs %}

    <div class="listhead">
      <div>
        <h1 class="h2">{{ schedule.name }}</h1>
        <div class="sub">
          <span class="muted">{% if schedule.checklist %}{{ schedule.checklist.name }}{% endif %}</span>
          {% if schedule.archived_at %}<span class="pill pill--tiny pill--ghost">Archived</span>{% endif %}
          {% if not schedule.enabled %}<span class="pill pill--tiny pill--ghost">Off</span>{% endif %}
        </div>
      </div>
      <div class="listhead__actions">
        <a class="btn btn--ghost btn--sm" href="{% url 'ui:checklist_schedules_list' %}">
          <svg class="ico" viewBox="0 0 24 24"><use href="#i-back"/></svg>
          Back
        </a>
        {% if not schedule.archived_at %}
          <a class="btn btn--danger btn--sm" href="{{ delete_url }}">
            <svg class="ico" viewBox="0 0 24 24"><use href="#i-trash"/></svg>
            Archive
          </a>
        {% endif %}
      </div>
    </div>

    <div class="split">
      <div class="split__main">
        <h3 class="h3">Edit Schedule</h3>
        <form method="post" class="form form--grid">
          {% csrf_token %}
          {{ form.as_p }}
          <button class="btn" type="submit">
            <svg class="ico" viewBox="0 0 24 24"><use href="#i-save"/></svg>
            Save
          </button>
        </form>

	        <div class="mt-18">
	          <h3 class="h3">Recent Runs</h3>
	          <div class="mini">
            {% for r in recent_runs %}
              <div class="mini__row">
                <a class="link mono" href="{% url 'ui:checklist_run_detail' run_id=r.id %}">{{ r.name }}</a>
                {% if r.scheduled_for %}<span class="muted">{{ r.scheduled_for|date:"Y-m-d" }}</span>{% endif %}
                <span class="pill pill--tiny">{% if r.status %}{{ r.status }}{% else %}...{% endif %}</span>
                {% if r.due_on %}<span class="muted">due {{ r.due_on|date:"Y-m-d" }}</span>{% endif %}
              </div>
            {% empty %}
              <div class="muted">No runs created yet.</div>
            {% endfor %}
          </div>
        </div>
      </div>

      <div class="split__side">
        <h3 class="h3">Schedule</h3>
        <div class="kv">
          <div class="kv__row"><div class="kv__k">Every</div><div class="kv__v">{{ schedule.repeat_summary }}</div></div>
          <div class="kv__row"><div class="kv__k">Next</div><div class="kv__v">{% if schedule.next_run_on %}{{ schedule.next_run_on|date:"Y-m-d" }}{% else %}-{% endif %}</div></div>
          <div class="kv__row"><div class="kv__k">Due offset</div><div class="kv__v">{% if schedule.due_days is not None %}{{ schedule.due_days }} day(s){% else %}-{% endif %}</div></div>
          <div class="kv__row"><div class="kv__k">Assigned</div><div class="kv__v">{% if schedule.assigned_to %}{{ schedule.assigned_to.username }}{% else %}-{% endif %}</div></div>
          <div class="kv__row"><div class="kv__k">Last created</div><div class="kv__v">{% if schedule.last_created_at %}{{ schedule.last_created_at|date:"Y-m-d H:i" }}{% else %}-{% endif %}</div></div>
        </div>
      </div>
    </div>
  </section>
{% endblock %}
