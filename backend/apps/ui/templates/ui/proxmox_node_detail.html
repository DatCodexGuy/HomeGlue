{% extends "ui/base.html" %}
{% block title %}{{ node.node }} | {{ conn.name }} | {{ org.name }}{% endblock %}
{% block content %}
  <section class="panel reveal">
    {% include "ui/_crumbs_simple.html" with crumbs=crumbs %}

    <div class="listhead">
      <div>
        <h1 class="h2">{{ node.node }}</h1>
        <div class="sub mono">{{ conn.name }}</div>
      </div>
      <div class="listhead__actions">
        <a class="btn btn--ghost btn--sm" href="{% url 'ui:proxmox_nodes' conn_id=conn.id %}">
          <svg class="ico" viewBox="0 0 24 24"><use href="#i-back"/></svg>
          Back
        </a>
      </div>
    </div>

    <div class="grid" style="margin-top:12px">
      <div class="card">
        <div class="card__title">Status</div>
        <div class="card__meta">
          <span class="pill pill--tiny {% if node.status == 'online' %}pill--ok{% endif %}">{{ node.status|default:"" }}</span>
          {% if node.uptime is not None %}
            <span class="pill pill--tiny">uptime: {{ node.uptime }}</span>
          {% endif %}
        </div>
        <div class="card__meta mono">CPU: {{ node.maxcpu|default:"?" }} Mem: {{ node.maxmem|default:"?" }} Disk: {{ node.maxdisk|default:"?" }}</div>
        <div class="card__meta mono">Updated: {{ node.updated_at|date:"Y-m-d H:i" }}</div>
      </div>

      <div class="card">
        <div class="card__title">Version</div>
        <div class="card__meta mono">{% firstof node.version_raw.version "?" %}</div>
      </div>
    </div>

    <div style="margin-top:18px">
      <h3 class="h3">Guests On Node</h3>
      <div class="tablewrap">
        <table class="table">
          <thead>
            <tr>
              <th>Guest</th>
              <th>Status</th>
              <th>IP</th>
              <th>CI</th>
            </tr>
          </thead>
          <tbody>
            {% for g in guests %}
              <tr>
                <td>
                  <div class="mono"><a class="link" href="{% url 'ui:proxmox_guest_detail' conn_id=conn.id guest_id=g.id %}">{{ g.guest_type }} {{ g.vmid }}</a></div>
                  <div class="muted">{{ g.name|default:"" }}</div>
                </td>
                <td><span class="pill pill--tiny {% if g.status == 'running' %}pill--ok{% elif g.status == 'stopped' %}pill--warn{% endif %}">{{ g.status|default:"" }}</span></td>
                <td class="mono">{% if g.ip_addrs and g.ip_addrs|length %}{{ g.ip_addrs.0 }}{% endif %}</td>
                <td>
                  {% if g.config_item_id %}
                    <a class="link mono" href="{% url 'ui:config_item_detail' item_id=g.config_item_id %}">open</a>
                  {% else %}
                    <span class="muted">-</span>
                  {% endif %}
                </td>
              </tr>
            {% empty %}
              <tr><td colspan="4" class="muted">No guests found.</td></tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>

    <div style="margin-top:18px">
      <h3 class="h3">Networks</h3>
      <div class="tablewrap">
        <table class="table">
          <thead>
            <tr>
              <th>Interface</th>
              <th>Kind</th>
              <th>Address</th>
              <th>Gateway</th>
            </tr>
          </thead>
          <tbody>
            {% for n in networks %}
              <tr>
                <td class="mono">{{ n.iface }}</td>
                <td class="mono">{{ n.kind }}</td>
                <td class="mono">{% if n.address %}{{ n.address }}{% endif %}{% if n.netmask %} / {{ n.netmask }}{% endif %}</td>
                <td class="mono">{{ n.gateway|default:"" }}</td>
              </tr>
            {% empty %}
              <tr><td colspan="4" class="muted">No networks found.</td></tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>

    <div style="margin-top:18px">
      <h3 class="h3">Storages</h3>
      <div class="tablewrap">
        <table class="table">
          <thead>
            <tr>
              <th>Storage</th>
              <th>Kind</th>
              <th>Status</th>
              <th>Usage</th>
            </tr>
          </thead>
          <tbody>
            {% for s in storages %}
              <tr>
                <td class="mono">{{ s.storage }}</td>
                <td class="mono">{{ s.kind }}</td>
                <td><span class="pill pill--tiny">{{ s.status|default:"" }}</span></td>
                <td class="mono">{% if s.used is not None and s.total is not None %}{{ s.used }} / {{ s.total }}{% endif %}</td>
              </tr>
            {% empty %}
              <tr><td colspan="4" class="muted">No storages found.</td></tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>

    <div style="margin-top:18px">
      <h3 class="h3">Relationships</h3>
      {% include "ui/_relationships.html" with relationships=relationships add_relationship_url=add_relationship_url %}
    </div>

    <div style="margin-top:18px">
      <h3 class="h3">Attachments</h3>
      {% include "ui/_attachments.html" with attachments=attachments %}
    </div>

    <div style="margin-top:18px">
      <h3 class="h3">Notes</h3>
      {% include "ui/_notes.html" with notes=notes note_ref=note_ref %}
    </div>

    <details style="margin-top:18px">
      <summary class="muted">Raw Proxmox payload</summary>
      <pre class="mono" style="white-space:pre-wrap; margin-top:10px">{% firstof node.raw "{}" %}</pre>
      <pre class="mono" style="white-space:pre-wrap; margin-top:10px">{% firstof node.status_raw "{}" %}</pre>
      <pre class="mono" style="white-space:pre-wrap; margin-top:10px">{% firstof node.version_raw "{}" %}</pre>
    </details>
  </section>
{% endblock %}

