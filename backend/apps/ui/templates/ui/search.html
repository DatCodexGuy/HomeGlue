{% extends "ui/base.html" %}
{% block title %}Search | {{ org.name }}{% endblock %}
{% block content %}
  <section class="panel reveal">
    {% include "ui/_crumbs_simple.html" with crumbs=crumbs %}
    <div class="listhead">
      <div>
        <h1 class="h2">Search</h1>
        <div class="sub">Search across assets, config items, docs, passwords, contacts, and more.</div>
      </div>
    </div>

	    <div class="viewbar mt-10">
      <div class="viewbar__left">
        <div class="viewbar__label">Items</div>
        <div class="viewbar__pills">
          <a class="pill pill--tiny {% if archived_mode == 'active' %}pill--active{% endif %}" href="{{ active_url }}">Active</a>
          <a class="pill pill--tiny {% if archived_mode == 'include' %}pill--active{% endif %}" href="{{ all_url }}">All</a>
          <a class="pill pill--tiny {% if archived_mode == 'only' %}pill--active{% endif %}" href="{{ archived_url }}">Archived</a>
        </div>
      </div>
    </div>

    <form class="searchwrap" method="get">
      <div class="search">
        <input class="search__input" type="text" name="q" value="{{ q }}" placeholder="Type to search..." autofocus />
        <button class="btn btn--ghost btn--sm" type="submit">
          <svg class="ico" viewBox="0 0 24 24"><use href="#i-search"/></svg>
          Search
        </button>
      </div>
      <div class="search__filters">
        {% for f in type_filters %}
          <label class="filterpill">
            <input type="checkbox" name="t" value="{{ f.key }}" {% if f.checked %}checked{% endif %} />
            <span>{{ f.label }}</span>
          </label>
        {% endfor %}
      </div>
    </form>

    {% if q %}
      <div class="table">
        <div class="row row--head">
          <div>Type</div><div>Result</div><div>Meta</div><div>Rel</div>
        </div>
        {% for r in results %}
          {% if r.url %}
            <a class="row" href="{{ r.url }}">
              <div><span class="pill pill--tiny">{{ r.type }}</span></div>
              <div class="titlecell">
                <div class="mono">{{ r.label }}</div>
                {% if r.snippet_html %}<div class="sub search__snippet">{{ r.snippet_html|safe }}</div>{% endif %}
              </div>
              <div class="muted">{{ r.meta }}</div>
              <div>
                {% if r.rel_count and r.ref %}
                  <span class="pill pill--tiny pill--click" role="link" tabindex="0" aria-label="View relationships" data-href="{% url 'ui:relationships_list' %}?ref={{ r.ref|urlencode }}">Rel {{ r.rel_count }}</span>
                {% elif r.rel_count %}
                  <span class="pill pill--tiny">Rel {{ r.rel_count }}</span>
                {% endif %}
              </div>
            </a>
          {% else %}
            <div class="row row--static">
              <div><span class="pill pill--tiny">{{ r.type }}</span></div>
              <div class="titlecell">
                <div class="mono">{{ r.label }}</div>
                {% if r.snippet_html %}<div class="sub search__snippet">{{ r.snippet_html|safe }}</div>{% endif %}
              </div>
              <div class="muted">{{ r.meta }}</div>
              <div>
                {% if r.rel_count and r.ref %}
                  <span class="pill pill--tiny pill--click" role="link" tabindex="0" aria-label="View relationships" data-href="{% url 'ui:relationships_list' %}?ref={{ r.ref|urlencode }}">Rel {{ r.rel_count }}</span>
                {% elif r.rel_count %}
                  <span class="pill pill--tiny">Rel {{ r.rel_count }}</span>
                {% endif %}
              </div>
            </div>
          {% endif %}
        {% empty %}
          <div class="empty">
            <div class="empty__title">No results</div>
            <div class="empty__body">Try a different query.</div>
          </div>
        {% endfor %}
      </div>
    {% else %}
      <div class="muted">Tip: try searching for a hostname, a serial number, or an email address.</div>
    {% endif %}
  </section>
{% endblock %}
