{% extends "ui/base.html" %}
{% block title %}{{ endpoint.name }} | Webhook | {{ org.name }}{% endblock %}
{% block content %}
  <section class="panel reveal">
    {% include "ui/_crumbs_simple.html" with crumbs=crumbs %}
    <div class="listhead">
      <div>
        <h1 class="h2">{{ endpoint.name }}</h1>
        <div class="sub">
          {% if endpoint.enabled %}<span class="pill pill--tiny">On</span>{% else %}<span class="pill pill--tiny pill--ghost">Off</span>{% endif %}
          <span class="dot"></span>
          <span class="muted mono">{{ endpoint.url }}</span>
        </div>
      </div>
      <div class="listhead__actions">
        <a class="btn btn--ghost btn--sm" href="{% url 'ui:webhook_endpoints_list' %}">
          <svg class="ico" viewBox="0 0 24 24"><use href="#i-back"/></svg>
          Back
        </a>
        <a class="btn btn--danger btn--sm" href="{{ delete_url }}">
          <svg class="ico" viewBox="0 0 24 24"><use href="#i-trash"/></svg>
          Delete
        </a>
      </div>
    </div>

    <h3 class="h3">Edit</h3>
    <form method="post" class="form form--grid">
      {% csrf_token %}
      {{ form.as_p }}
      <button class="btn" type="submit">
        <svg class="ico" viewBox="0 0 24 24"><use href="#i-save"/></svg>
        Save
      </button>
    </form>

	    <div class="mt-18">
	      <h3 class="h3">Sample Payload</h3>
	      <pre class="code prewrap maxh-320">{{ sample_payload_json }}</pre>
	      <div class="muted mt-8">
	        Signature header: <span class="mono">X-HomeGlue-Signature: sha256=...</span> (only if a secret is set).
	      </div>
	    </div>
	
	    <div class="mt-18">
	      <div class="listhead mb-10">
	        <div>
	          <h3 class="h3">Recent Deliveries</h3>
	          <div class="sub">Last delivery attempts for this webhook.</div>
        </div>
        <div class="listhead__actions">
          <a class="btn btn--ghost btn--sm" href="{{ delivery_url }}">
            <svg class="ico" viewBox="0 0 24 24"><use href="#i-bolt"/></svg>
            View all
          </a>
        </div>
      </div>
      <div class="mini">
        {% for a in recent_attempts %}
          <div class="mini__row">
            <div class="mini__top">
              <span class="mono">{{ a.attempted_at|date:"Y-m-d H:i" }}</span>
              {% if a.ok %}<span class="pill pill--tiny pill--ok">OK</span>{% else %}<span class="pill pill--tiny pill--danger">Fail</span>{% endif %}
              {% if a.status_code %}<span class="muted">HTTP {{ a.status_code }}</span>{% endif %}
              {% if a.notification and a.notification.user %}<span class="muted">{{ a.notification.user.username }}</span>{% endif %}
            </div>
            {% if a.notification %}<div class="mono">{{ a.notification.title }}</div>{% endif %}
            {% if not a.ok and a.error %}<div class="muted">{{ a.error }}</div>{% endif %}
          </div>
        {% empty %}
          <div class="muted">No deliveries attempted yet.</div>
        {% endfor %}
      </div>
    </div>
  </section>
{% endblock %}
